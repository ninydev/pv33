<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Audio DB</title>
</head>
<body>

<header>
    <h1>The Audio DB </h1>
</header>

<div id="dashboard">
    <label>Search: <input type="text" id="search"></label>
    <button id="btnSearch">Search</button>
</div>

<main id="content">
    <ul id="result"></ul>
</main>

<script>
    const API_KEY = '123';
    const API_URL_V1 = 'https://www.theaudiodb.com/api/v1/json';
    const API_URL_V2 = 'https://www.theaudiodb.com/api/v2/json';
    const SEARCH_URL = `${API_URL_V1}/${API_KEY}/search.php?s=`;
    const ALBUM_URL = `${API_URL_V1}/${API_KEY}/discography-mb.php?s=`;

    document.getElementById('btnSearch').addEventListener('click', () => {

        // 1 - validate
        let search = document.getElementById('search').value;
        if (!search) return;
        if (search.length < 3) return;

        fetch(SEARCH_URL + search)
            // 2 - process response status
            .then(res => {
                    if (!res.ok) {
                        throw new Error('Error fetching data' + res.statusText + ' (' + res.status + ')');
                    }
                    return res.json()
                }
            )
            // 3 - process response data
            .then(data => {
                console.log(data)
                document.getElementById('result').innerHTML = '';

                // 4 - process data - has results?
                if (!data.artists) {
                    console.log('No results found')
                    return;
                }

                // 5 - process data - display results
                data.artists.forEach(artist => {
                    console.log(artist)
                    let html = `
<li>
    <img src="${artist.strArtistThumb}" alt="${artist.strArtist}">
    <h2>${artist.strArtist}</h2>
    <p>Formed in: ${artist.intFormedYear}</p>
    <p>Genre: ${artist.strGenre}</p>
    <p>Country: ${artist.strCountry}</p>
    <p><a href="https://${artist.strWebsite}" target="_top">Website</a></p>
    <p>${artist.strBiographyEN}</p>
</li>
`
                    document.getElementById('result').innerHTML += html;

                    // 6 - process data - albums

                    fetch(ALBUM_URL + artist.strMusicBrainzID)
                        .then(res => {
                            if (!res.ok) {
                                throw new Error('Error fetching albums' + res.statusText + ' (' + res.status + ')');
                            }
                            return res.json()
                        })
                        .then(data => {
                            console.log(data)
                            if (!data.album) return;
                            let html = '<h3>Albums:</h3><ul>';
                            data.album.forEach(album => {
                                html += `<li>
                                    <p>${album.strAlbum} (${album.intYearReleased})</p>
                                </li>`;
                            })
                            html += '</ul>';
                            document.getElementById('result').innerHTML += html;

                        })

                })
            })
            .catch(err => console.log(err))
    })


</script>

</body>
</html>