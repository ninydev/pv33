<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Пошук фільмів</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            padding: 20px;
            background-color: #f8f9fa;
        }

        #searchForm {
            margin-bottom: 30px;
        }

        #results .movie-card {
            margin-bottom: 20px;
        }

        #pagination {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
            margin: 20px 0;
        }
    </style>

</head>
<body>

<div class="container">
    <h2 class="text-center mb-4">Пошук фільмів</h2>


    <form id="searchForm" class="row g-3 justify-content-center mb-4">
        <div class="col-auto">
            <input type="text" id="titleInput" class="form-control" placeholder="Назва" required>
        </div>
        <div class="col-auto">
            <select id="typeSelect" class="form-select">
                <option value="movie">movie</option>
                <option value="series">series</option>
                <option value="episode">episode</option>
            </select>
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary">Пошук</button>
        </div>
    </form>


    <div id="results" class="row justify-content-center"></div>

    <!-- Пагінація -->
    <div id="pagination"></div>
</div>


<div class="modal fade" id="movieModal" tabindex="-1" aria-labelledby="movieModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="movieModalLabel">Деталі фільму</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрити"></button>
            </div>
            <div class="modal-body d-flex">
                <img id="modalPoster" src="" alt="" class="me-3" style="width:200px; height:280px; object-fit:cover;">
                <div id="modalInfo"></div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const API_KEY = "53cc027b";
    const BASE_URL = `https://www.omdbapi.com/?apikey=${API_KEY}`;

    const form = document.getElementById("searchForm");
    const resultsDiv = document.getElementById("results");
    const paginationDiv = document.getElementById("pagination");

    let currentSearch = "";
    let currentType = "";
    let currentPage = 1;

    form.addEventListener("submit", function (e) {
        e.preventDefault();
        currentSearch = document.getElementById("titleInput").value.trim();
        currentType = document.getElementById("typeSelect").value;
        if (currentSearch === "") {
            alert("Введіть назву фільму!");
            return;
        }
        currentPage = 1;
        searchMovies(currentSearch, currentType, currentPage);
    });

    function searchMovies(title, type, page) {
        const url = `${BASE_URL}&s=${encodeURIComponent(title)}&type=${type}&page=${page}`;
        fetch(url)
            .then(res => res.json())
            .then(data => {
                resultsDiv.innerHTML = "";
                paginationDiv.innerHTML = "";

                if (data.Response === "False") {
                    resultsDiv.innerHTML = "<p class='text-center'>Фільми не знайдено!</p>";
                    return;
                }

                data.Search.forEach(movie => {
                    const div = document.createElement("div");
                    div.className = "col-md-3 movie-card";
                    div.innerHTML = `
                        <div class="card h-100">
                            <img src="${movie.Poster !== "N/A" ? movie.Poster : ""}" class="card-img-top" alt="${movie.Title}">
                            <div class="card-body">
                                <h5 class="card-title">${movie.Title}</h5>
                                <p class="card-text">(${movie.Year})<br>[${movie.Type}]</p>
                                <button onclick="getDetails('${movie.imdbID}')" class="btn btn-sm btn-outline-primary">Деталі</button>
                            </div>
                        </div>
                    `;
                    resultsDiv.appendChild(div);
                });

                const totalPages = Math.ceil(data.totalResults / 10);
                for (let i = 1; i <= totalPages; i++) {
                    const btn = document.createElement("button");
                    btn.textContent = i;
                    btn.className = "btn btn-outline-secondary";
                    if (i === currentPage) btn.classList.add("btn-primary", "text-white");
                    btn.onclick = function() {
                        currentPage = i;
                        searchMovies(currentSearch, currentType, currentPage);
                    };
                    paginationDiv.appendChild(btn);
                }
            })
            .catch(err => {
                console.error(err);
                resultsDiv.innerHTML = "<p class='text-center'>Помилка при завантаженні даних</p>";
            });
    }

    function getDetails(id) {
        const url = `${BASE_URL}&i=${id}&plot=full`;
        fetch(url)
            .then(res => res.json())
            .then(movie => {
                document.getElementById("modalPoster").src = movie.Poster !== "N/A" ? movie.Poster : "";
                document.getElementById("modalPoster").alt = movie.Title;
                document.getElementById("modalInfo").innerHTML = `
                    <h4>${movie.Title} (${movie.Year})</h4>
                    <p><b>Жанр:</b> ${movie.Genre}</p>
                    <p><b>Режисер:</b> ${movie.Director}</p>
                    <p><b>Актори:</b> ${movie.Actors}</p>
                    <p><b>Сюжет:</b> ${movie.Plot}</p>
                    <p><b>IMDB рейтинг:</b> ${movie.imdbRating}</p>
                `;

                const myModal = new bootstrap.Modal(document.getElementById('movieModal'));
                myModal.show();
            })
            .catch(err => {
                console.error(err);
            });
    }
</script>

</body>
</html>
